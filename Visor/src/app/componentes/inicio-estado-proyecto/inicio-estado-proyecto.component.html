<div id="container-all">
  <div id="header">
      <div id="titulo"><h1>Estado de proyectos</h1></div>
      <mat-form-field appearance="outline" class="input-header">
        <mat-label><mat-icon>search</mat-icon> Buscar proyectos...</mat-label>
        <input matInput name="proyecto" (keyup)="applyFilter($event)" #input autocomplete="off" [(ngModel)]="inputIzq">
      </mat-form-field>
      <button class="boton-icono" (click)="openFiltro()" mat-mini-fab color="primary" mat-button matTooltip="Filtro Avanzado"><mat-icon class="icon">filter_alt</mat-icon></button>
      <button class="boton-icono" mat-mini-fab color="primary" (click)="contraerProyectos()" mat-button matTooltip="Cerrar Proyectos"><mat-icon class="icon">close_fullscreen</mat-icon></button>
      <mat-form-field appearance="outline" id="ordenarPor">
        <mat-label>Ordenar por...</mat-label>
        <mat-select [(value)]="ordenDeFiltrado">
          <mat-option (click)="dispararOrden($event)" *ngFor="let filtro of tipoDeFiltro" [value]="filtro.value">
            {{filtro.viewValue}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="container-informacion">
        <div id="seccion-informacion" [ngClass]="{ 'visible': estado == true, 'noVisible': estado == false }">
          <div id="seccion-completadas">
            <div class="cc-no-iniciadas"></div>
            <p class="letrasSeccionInformacion">No iniciadas</p>
          </div>
          <div id="seccion-en-progreso">
            <div class="cc-en-progreso"></div>
            <p class="letrasSeccionInformacion">En progreso</p>
          </div>
          <div id="seccion-en-prueba">
            <div class="cc-en-prueba"></div>
            <p class="letrasSeccionInformacion">En prueba</p>
          </div>
          <div id="seccion-completadas">
            <div class="cc-completadas"></div>
            <p class="letrasSeccionInformacion">Completadas</p>
          </div>
        </div>
        <button class="boton-informacion" (click)="mostrarInformacion()" mat-mini-fab color="primary"><mat-icon class="icony">info</mat-icon></button>
      </div>
      <div class="disponibilidad-proyectos" [ngClass]="{'acomodar': estado == true}">
        <h3>Tareas atrasadas<mat-divider></mat-divider></h3>
        <div id="porcentaje-disponibilidad-proyectos" [ngClass]="{
            'porcentaje-rojo': getPorcentajeRojo(disponibilidadProyectos),
            'porcentaje-amarillo': getPorcentajeAmarillo(disponibilidadProyectos),
            'porcentaje-verde-claro': getPorcentajeVerdeClaro(disponibilidadProyectos),
            'porcentaje-verde-oscuro': getPorcentajeVerdeOscuro(disponibilidadProyectos) }"
            matTooltip="{{getTooltipTareasAtrasadas()}} Tareas totales con fecha planificada anterior / 
            {{getTooltipTareasAbiertasTotales()}} Tareas totales"   
            [matTooltipPosition]="position.value!"> {{ disponibilidadProyectos }}%
      </div>
    </div>
  </div>

    <div class="mensaje-no-proyectos" *ngIf="noHayProyectos"><h1>No coinciden proyectos con la busqueda</h1></div>
    <div id="container-body" *ngIf="!noHayProyectos">
      <mat-accordion>
      <table mat-table [dataSource]="data" multiTemplateDataRows class="mat-elevation-z8">
      <!-- Nombre Column -->
      <ng-container matColumnDef="nombre" class="columna">
        <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Nombre </th>
        <td mat-cell *matCellDef="let element"><div id="nombre"><b>{{element.nombre}}</b></div></td>
      </ng-container>

      <!-- Tareas a tiempo Column -->
        <ng-container matColumnDef="tareasATiempo">
          <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Tareas a tiempo </th>
          <td mat-cell *matCellDef="let element"> <div id="tareasATiempo">{{element.porcentajeTareasATiempo}}%</div></td>
        </ng-container>
      
      <!-- Tareas atrasadas Column -->
        <ng-container matColumnDef="tareasAtrasadas" class="columna">
          <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Tareas atrasadas </th>
          <td mat-cell *matCellDef="let element"><div id="tareasAtrasadas">{{element.porcentajeTareasAtrasadas}}%</div></td>
        </ng-container>
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
        <td mat-cell *matCellDef="let element">
        <button mat-icon-button aria-label="expand row" (click)="(expandedElement = expandedElement === element ? null : element); $event.stopPropagation()">
          <mat-icon *ngIf="expandedElement !== element">keyboard_arrow_down</mat-icon>
          <mat-icon *ngIf="expandedElement === element">keyboard_arrow_up</mat-icon>
        </button>
      </td>
    </ng-container>

    <!-- Columna expandible -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let proyecto; let i = dataIndex" [attr.colspan]="columnsToDisplayWithExpand.length">
      <div class="example-element-detail" [@detailExpand]="proyecto == expandedElement ? 'expanded' : 'collapsed'">
        <div class="contenido">
          <div id="seccionAvance">
            <b><p class="subtitulo">Avance del proyecto</p></b>
          </div>
          <div class="barra">
            <div id="barraRoja">
              <p>{{retornarPorcentajeNoIniciadas(i)}}%</p>
            </div>
            <div id="barraAmarilla">
              <p>{{retornarPorcentajeEnProgreso(i)}}%</p>
            </div>
            <div id="barraEnPrueba">
              <p>{{retornarPorcentajeEnPrueba(i)}}%</p>
            </div>
            <div id="barraVerde">
              <p>{{retornarPorcentajeCompletadas(i)}}%</p>
            </div>
          </div>
          <div id="vacio">
          </div>
          <div class="seccionAvanceArea">
              <mat-expansion-panel hideToggle>
                <mat-expansion-panel-header>
                  <mat-panel-title> 
                    <div id="seccionAvanceArea">
                      <b><p>Avance por área</p></b>
                    </div> 
                  </mat-panel-title>
                  <mat-panel-description>
                  </mat-panel-description>
                </mat-expansion-panel-header>
                  <div class="containerBarrasArea">
                    <div class="barraAvance">
                      <div style="font-style: italic;">Diseño funcional:</div>
                      <div class="espacio"></div>
                      <div class="barraAreaRoja">{{retornarPorcentajeAvanceFuncionalNoIniciadas(i)}}%</div>
                      <div class="barraAreaAmarilla">{{retornarPorcentajeAvanceFuncionalEnProgreso(i)}}%</div>
                      <div class="barraAreaEnPrueba">{{retornarPorcentajeAvanceFuncionalEnPrueba(i)}}%</div>
                      <div class="barraAreaVerde">{{retornarPorcentajeAvanceFuncionalCompletadas(i)}}%</div>
                    </div>
                    <div class="barraAvance">
                      <div style="font-style: italic;">Diseño técnico:</div>
                      <div id="espacioTecnico"></div>
                      <div class="barraAreaRoja">{{retornarPorcentajeAvanceTecnicoNoIniciadas(i)}}%</div>
                      <div class="barraAreaAmarilla">{{retornarPorcentajeAvanceTecnicoEnProgreso(i)}}%</div>
                      <div class="barraAreaEnPrueba">{{retornarPorcentajeAvanceTecnicoEnPrueba(i)}}%</div>
                      <div class="barraAreaVerde">{{retornarPorcentajeAvanceTecnicoCompletadas(i)}}%</div>
                    </div>
                    <div class="barraAvance">
                      <div style="font-style: italic;">Desarrollo:</div>
                      <div id="espacioDesarrollo"></div>
                      <div class="barraAreaRoja">{{retornarPorcentajeAvanceDesarrolloNoIniciadas(i)}}%</div>
                      <div class="barraAreaAmarilla">{{retornarPorcentajeAvanceDesarrolloEnProgreso(i)}}%</div>
                      <div class="barraAreaEnPrueba">{{retornarPorcentajeAvanceDesarrolloEnPrueba(i)}}%</div>
                      <div class="barraAreaVerde">{{retornarPorcentajeAvanceDesarrolloCompletadas(i)}}%</div>
                    </div>

                    <div class="barraAvance">
                      <div style="font-style: italic;">Testing:</div>
                      <div id="espacioTesting"></div>
                      <div class="barraAreaRoja">{{retornarPorcentajeAvanceTestingNoIniciadas(i)}}%</div>
                      <div class="barraAreaAmarilla">{{retornarPorcentajeAvanceTestingEnProgreso(i)}}%</div>
                      <div class="barraAreaEnPrueba">{{retornarPorcentajeAvanceTestingEnPrueba(i)}}%</div>
                      <div class="barraAreaVerde">{{retornarPorcentajeAvanceTestingCompletadas(i)}}%</div>
                    </div>
                  </div>
              </mat-expansion-panel>
          </div>
        </div>
      </div>
      </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
      <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;" class="example-element-row" [class.example-expanded-row]="expandedElement === element" (click)="expandedElement = expandedElement === element ? null : element"></tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>
      </mat-accordion>
    </div>
</div>