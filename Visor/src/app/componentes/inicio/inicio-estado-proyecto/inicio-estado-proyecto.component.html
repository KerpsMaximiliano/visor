<div id="container-all">
  <div id="header">
      <div id="titulo"><h1>Estado de proyectos</h1></div>
      <mat-form-field appearance="outline" class="input-header">
        <mat-label><mat-icon>search</mat-icon> Buscar proyecto... </mat-label>
        <input matInput name="proyecto" (keyup)="applyFilter($event)" #input autocomplete="off" [(ngModel)]="inputIzq">
      </mat-form-field>
      <button class="boton-icono" mat-mini-fab color="primary" (click)="openFiltro()" mat-button matTooltip="Filtro Avanzado"><mat-icon class="icon">filter_alt</mat-icon></button>
      <button class="boton-icono" mat-mini-fab color="primary" (click)="contraerProyectos()" mat-button matTooltip="Cerrar Proyectos"><mat-icon class="icon">close_fullscreen</mat-icon></button>
      <button id="button-orden" mat-button [matMenuTriggerFor]="menuOrden"> {{ordenSeleccion}} <mat-icon>expand_more</mat-icon></button>
      <mat-menu #menuOrden="matMenu"><button mat-button *ngFor="let o of orden" class="menu-orden" (click)="dispararOrden($event)">{{o}}</button></mat-menu>

      <div class="container-informacion">
        <div id="seccion-informacion" [ngClass]="{ 'visible': estado == true, 'noVisible': estado == false }">
          <div id="seccion-completadas">
            <div class="cc-no-iniciadas"></div>
            <p class="letrasSeccionInformacion">No iniciadas</p>
          </div>
          <div id="seccion-en-progreso">
            <div class="cc-en-progreso"></div>
            <p class="letrasSeccionInformacion">En progreso</p>
          </div>
          <div id="seccion-en-prueba">
            <div class="cc-en-prueba"></div>
            <p class="letrasSeccionInformacion">En prueba</p>
          </div>
          <div id="seccion-completadas">
            <div class="cc-completadas"></div>
            <p class="letrasSeccionInformacion">Completadas</p>
          </div>
        </div>
        <button class="boton-informacion" (click)="mostrarInformacion()" matTooltip="Información" mat-mini-fab color="primary"><mat-icon class="icony">info</mat-icon></button>
      </div>
      <div class="disponibilidad-proyectos" [ngClass]="{'acomodar': estado == true}">
        <h3>Tareas atrasadas<mat-divider></mat-divider></h3>
        <div id="porcentaje-disponibilidad-proyectos" [ngClass]="{
            'porcentaje-rojo': getPorcentajeRojo(disponibilidadProyectos),
            'porcentaje-amarillo': getPorcentajeAmarillo(disponibilidadProyectos),
            'porcentaje-verde-claro': getPorcentajeVerdeClaro(disponibilidadProyectos),
            'porcentaje-verde-oscuro': getPorcentajeVerdeOscuro(disponibilidadProyectos) }"
            matTooltip="{{getTooltipTareasAtrasadas()}} Tareas totales con fecha planificada anterior / 
            {{getTooltipTareasAbiertasTotales()}} Tareas totales"   
            [matTooltipPosition]="position.value!"> {{ disponibilidadProyectos }}%
      </div>
    </div>
  </div>

    <div class="mensaje-no-proyectos" *ngIf="noHayProyectos"><h1>No coinciden proyectos con la busqueda</h1></div>
    <div id="container-body" *ngIf="!noHayProyectos">
      <mat-accordion [multi]="true">
      <table mat-table [dataSource]="data" multiTemplateDataRows class="mat-elevation-z8">
      <!-- Nombre Column -->
      <ng-container matColumnDef="nombre" class="columna">
        <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Nombre </th>
        <td mat-cell *matCellDef="let element"><div id="nombre"><b>{{element.nombre}}</b></div></td>
      </ng-container>

      <!-- Tareas a tiempo Column -->
        <ng-container matColumnDef="tareasATiempo">
          <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Tareas a tiempo </th>
          <td mat-cell *matCellDef="let element"> <div id="tareasATiempo">{{element.porcentajeTareasATiempo}}%</div></td>
        </ng-container>
      
      <!-- Tareas atrasadas Column -->
        <ng-container matColumnDef="tareasAtrasadas" class="columna">
          <th mat-header-cell *matHeaderCellDef class="tituloColumna"> Tareas atrasadas </th>
          <td mat-cell *matCellDef="let element"><div id="tareasAtrasadas">{{element.porcentajeTareasAtrasadas}}%</div></td>
        </ng-container>
      <ng-container matColumnDef="expand" class="columna">
      <th mat-header-cell *matHeaderCellDef class="tituloColumna"></th>
      <td mat-cell *matCellDef="let element">
        <a mat-button href="javascript:void()" (click)="element.isExpanded = !element.isExpanded"><mat-icon>keyboard_arrow_down</mat-icon></a>
      </td>
    </ng-container>

    <!-- Columna expandible -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let proyecto; let i = dataIndex" [attr.colspan]="columnsToDisplayWithExpand.length">
      <div class="row example-element-detail" [@detailExpand]="proyecto.isExpanded ? 'expanded' : 'collapsed'">
        <div class="contenido">
          <div id="seccionAvance">
            <b><p class="subtitulo">Avance del proyecto</p></b>
          </div>

          <div id="barraGeneral">
            <div class="progress" style="max-width: 100%;" >
              <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPNoIniciadas == 0, 'progress-bar bg-danger': this.proyectos[i].porcentajeHPNoIniciadas}" [style.width.%]="retornarPorcentajeNoIniciadas(i)+4">{{retornarPorcentajeNoIniciadas(i)}}%</div>
              <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnProgreso == 0, 'progress-bar bg-warning progress-bar-stripped': this.proyectos[i].porcentajeHPEnProgreso}" [style.width.%]="retornarPorcentajeEnProgreso(i)+4">{{retornarPorcentajeEnProgreso(i)}}%</div>
              <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnPrueba == 0, 'progress-bar light-green': this.proyectos[i].porcentajeHPEnPrueba}" style="background-color: #00FF00;" [style.width.%]="retornarPorcentajeEnPrueba(i)+4">{{retornarPorcentajeEnPrueba(i)}}%</div>
              <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPCompletadas == 0, 'progress-bar bg-success': this.proyectos[i].porcentajeHPCompletadas}" [style.width.%]="retornarPorcentajeCompletadas(i)+4">{{retornarPorcentajeCompletadas(i)}}%</div>
            </div>  
          </div>
          <div id="vacio">
          </div>
          <div class="seccionAvanceArea">
              <mat-expansion-panel hideToggle>
                <mat-expansion-panel-header>
                  <mat-panel-title id="tituloAvanceArea"> 
                    <div id="seccionAvanceArea">
                      <b><p class="subtitulo">Avance por área</p></b>
                      <mat-icon id="iconoArea">keyboard_arrow_down</mat-icon>
                    </div> 
                  </mat-panel-title>
                  <mat-panel-description>
                  </mat-panel-description>
                </mat-expansion-panel-header>

                  <div class="containerBarrasArea">
                    <div class="barraAvance">
                      <strong><p class="letrasSegundoNivel">Diseño funcional</p></strong>
                      <div [ngClass]="{'noVisible': this.proyectos[i].cerosEstadoFuncional}" id="container-barras" class="progress" style="max-width: 100%;">
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPNoIniciadasDisenioFuncional == 0, 'progress-bar bg-danger': this.proyectos[i].porcentajeHPNoIniciadasDisenioFuncional}" [style.width.%]="retornarPorcentajeAvanceFuncionalNoIniciadas(i)+4">{{retornarPorcentajeAvanceFuncionalNoIniciadas(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnProgresoDisenioFuncional == 0, 'progress-bar bg-warning progress-bar-stripped': this.proyectos[i].porcentajeHPEnProgresoDisenioFuncional}" [style.width.%]="retornarPorcentajeAvanceFuncionalEnProgreso(i)+4">{{retornarPorcentajeAvanceFuncionalEnProgreso(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnPruebaDisenioFuncional == 0, 'progress-bar light-green': this.proyectos[i].porcentajeHPEnPruebaDisenioFuncional}" style="background-color: #00FF00;" [style.width.%]="retornarPorcentajeAvanceFuncionalEnPrueba(i)+4">{{retornarPorcentajeAvanceFuncionalEnPrueba(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPCompletadasDisenioFuncional == 0, 'progress-bar bg-success': this.proyectos[i].porcentajeHPCompletadasDisenioFuncional}" [style.width.%]="retornarPorcentajeAvanceFuncionalCompletadas(i)+4">{{retornarPorcentajeAvanceFuncionalCompletadas(i)}}%</div>
                      </div>
                      <div [ngClass]="{'noVisible': !this.proyectos[i].cerosEstadoFuncional, 'mensajeNoTareas': this.proyectos[i].cerosEstadoFuncional}"><p>Este área no tiene tareas asignadas</p></div>
                    </div>

                    <div class="barraAvance">
                      <strong><p class="letrasSegundoNivel">Diseño técnico</p></strong>
                      <div [ngClass]="{'noVisible': this.proyectos[i].cerosEstadoTecnico}" id="container-barras" class="progress" style="max-width: 100%;" >
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPNoIniciadasDisenioTecnico == 0, 'progress-bar bg-danger': this.proyectos[i].porcentajeHPNoIniciadasDisenioTecnico}" [style.width.%]="retornarPorcentajeAvanceTecnicoNoIniciadas(i)+4">{{retornarPorcentajeAvanceTecnicoNoIniciadas(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnProgresoDisenioTecnico == 0, 'progress-bar bg-warning progress-bar-stripped': this.proyectos[i].porcentajeHPEnProgresoDisenioTecnico}" [style.width.%]="retornarPorcentajeAvanceTecnicoEnProgreso(i)+4">{{retornarPorcentajeAvanceTecnicoEnProgreso(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnPruebaDisenioTecnico == 0, 'progress-bar light-green': this.proyectos[i].porcentajeHPEnPruebaDisenioTecnico}" style="background-color: #00FF00;" [style.width.%]="retornarPorcentajeAvanceTecnicoEnPrueba(i)+4">{{retornarPorcentajeAvanceTecnicoEnPrueba(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPCompletadasDisenioTecnico == 0, 'progress-bar bg-success': this.proyectos[i].porcentajeHPCompletadasDisenioTecnico}" [style.width.%]="retornarPorcentajeAvanceTecnicoCompletadas(i)+4">{{retornarPorcentajeAvanceTecnicoCompletadas(i)}}%</div>
                      </div>
                      <div [ngClass]="{'noVisible': !this.proyectos[i].cerosEstadoTecnico, 'mensajeNoTareas': this.proyectos[i].cerosEstadoTecnico}"><p>Este área no tiene tareas asignadas</p></div>
                    </div>
                    
                    <div class="barraAvance">
                      <strong><p class="letrasSegundoNivel">Desarrollo</p></strong>
                      <div [ngClass]="{'noVisible': this.proyectos[i].cerosEstadoDesarrollo}" id="container-barras" class="progress" style="max-width: 100%;" >
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPNoIniciadasDesarrollo == 0, 'progress-bar bg-danger': this.proyectos[i].porcentajeHPNoIniciadasDesarrollo}" [style.width.%]="retornarPorcentajeAvanceDesarrolloNoIniciadas(i)+4">{{retornarPorcentajeAvanceDesarrolloNoIniciadas(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnProgresoDesarrollo == 0, 'progress-bar bg-warning progress-bar-stripped': this.proyectos[i].porcentajeHPEnProgresoDesarrollo}" [style.width.%]="retornarPorcentajeAvanceDesarrolloEnProgreso(i)+4">{{retornarPorcentajeAvanceDesarrolloEnProgreso(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnPruebaDesarrollo == 0, 'progress-bar light-green': this.proyectos[i].porcentajeHPEnPruebaDesarrollo}"class="progress-bar light-green" style="background-color: #00FF00;" [style.width.%]="retornarPorcentajeAvanceDesarrolloEnPrueba(i)+4">{{retornarPorcentajeAvanceDesarrolloEnPrueba(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPCompletadasDesarrollo == 0, 'progress-bar bg-success': this.proyectos[i].porcentajeHPCompletadasDesarrollo}" [style.width.%]="retornarPorcentajeAvanceDesarrolloCompletadas(i)+4">{{retornarPorcentajeAvanceDesarrolloCompletadas(i)}}%</div>
                      </div>
                      <div [ngClass]="{'noVisible': !this.proyectos[i].cerosEstadoDesarrollo, 'mensajeNoTareas': this.proyectos[i].cerosEstadoDesarrollo}"><p>Este área no tiene tareas asignadas</p></div>
                    </div>

                    <div class="barraAvance">
                      <strong><p class="letrasSegundoNivel">Testing</p></strong>
                      <div [ngClass]="{'noVisible': this.proyectos[i].cerosEstadoTesting}" id="container-barras" class="progress" style="max-width: 100%;">
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPNoIniciadasTesting == 0, 'progress-bar bg-danger': this.proyectos[i].porcentajeHPNoIniciadasTesting}" [style.width.%]="retornarPorcentajeAvanceTestingNoIniciadas(i)+4">{{retornarPorcentajeAvanceTestingNoIniciadas(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnProgresoTesting == 0, 'progress-bar bg-warning progress-bar-stripped': this.proyectos[i].porcentajeHPEnProgresoTesting}" [style.width.%]="retornarPorcentajeAvanceTestingEnProgreso(i)+4">{{retornarPorcentajeAvanceTestingEnProgreso(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPEnPruebaTesting == 0, 'progress-bar light-green': this.proyectos[i].porcentajeHPEnPruebaTesting}" style="background-color: #00FF00;" [style.width.%]="retornarPorcentajeAvanceTestingEnPrueba(i)+4">{{retornarPorcentajeAvanceTestingEnPrueba(i)}}%</div>
                        <div [ngClass]="{'noVisible': this.proyectos[i].porcentajeHPCompletadasTesting == 0, 'progress-bar bg-success': this.proyectos[i].porcentajeHPCompletadasTesting}" [style.width.%]="retornarPorcentajeAvanceTestingCompletadas(i)+4">{{retornarPorcentajeAvanceTestingCompletadas(i)}}%</div>
                      </div>
                      <div [ngClass]="{'noVisible': !this.proyectos[i].cerosEstadoTesting, 'mensajeNoTareas': this.proyectos[i].cerosEstadoTesting}"><p>Este área no tiene tareas asignadas</p></div>
                    </div>
                  </div>
              </mat-expansion-panel>
          </div>
        </div>
      </div>
      </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand;sticky: true"></tr>
      <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;" class="example-element-row" [class.example-expanded-row]="expandedElement === element" (click)="expandedElement = expandedElement === element ? null : element"></tr>
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>
      </mat-accordion>
    </div>
</div>